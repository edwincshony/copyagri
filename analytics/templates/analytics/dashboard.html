{% extends 'accounts/base.html' %}
{% load static %}

{% block title %}Analytics Dashboard{% endblock %}

{% block content %}

<div class="container-fluid py-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold mb-0">ðŸ“Š Analytics Dashboard</h3>
    </div>

    <!-- Filters -->
    {% comment %} <div class="row mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm h-100">
                <div class="card-body d-flex flex-column justify-content-center">
                    <label class="form-label fw-semibold text-secondary mb-2">Time Period</label>
                    <select class="form-select" id="timePeriodFilter">
                        <option value="7">Last 7 days</option>
                        <option value="30" selected>Last 30 days</option>
                        <option value="90">Last 90 days</option>
                        <option value="365">Last year</option>
                    </select>
                </div>
            </div>
        </div>
    </div> {% endcomment %}

    <!-- Stats Row -->
    <div class="row g-4">

        <!-- Users -->
        <div class="col-md-3">
            <div class="card shadow-sm h-100">
                <div class="card-body d-flex flex-column justify-content-between">
                    <div>
                        <h6 class="text-uppercase text-muted fw-semibold small mb-2">Total Users</h6>
                        <h2 class="fw-bold mb-1" id="totalUsers">0</h2>
                        <div class="small">
                            <span class="badge bg-success-subtle text-success">Farmers: <span id="farmerCount">0</span></span>
                            <span class="badge bg-primary-subtle text-primary ms-2">Buyers: <span id="buyerCount">0</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Revenue -->
        <div class="col-md-3">
            <div class="card shadow-sm h-100">
                <div class="card-body d-flex flex-column justify-content-between">
                    <div>
                        <h6 class="text-uppercase text-muted fw-semibold small mb-2">Total Revenue</h6>
                        <h2 class="fw-bold mb-2">â‚¹<span id="totalRevenue">0</span></h2>
                        <ul class="list-unstyled small mb-0">
                            <li>Direct: â‚¹<span id="purchaseRevenue">0</span></li>
                            <li>Bids: â‚¹<span id="bidRevenue">0</span></li>
                            <li>Cultivation: â‚¹<span id="cultivationRevenue">0</span></li>
                            <li>Storage: â‚¹<span id="storageRevenue">0</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bookings -->
        <div class="col-md-3">
            <div class="card shadow-sm h-100">
                <div class="card-body d-flex flex-column justify-content-between">
                    <div>
                        <h6 class="text-uppercase text-muted fw-semibold small mb-2">Total Bookings</h6>
                        <h2 class="fw-bold mb-1" id="totalBookings">0</h2>
                        <div class="small">
                            <span class="badge bg-info-subtle text-info">Storage: <span id="storageBookings">0</span></span>
                            <span class="badge bg-warning-subtle text-warning ms-2">Cultivation: <span id="cultivationBookings">0</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Listings -->
        <div class="col-md-3">
            <div class="card shadow-sm h-100">
                <div class="card-body d-flex flex-column justify-content-between">
                    <div>
                        <h6 class="text-uppercase text-muted fw-semibold small mb-2">Total Listings</h6>
                        <h2 class="fw-bold mb-1" id="totalListings">0</h2>
                        <span class="badge bg-secondary-subtle text-secondary">Active: <span id="activeListings">0</span></span>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

{% endblock %}

{% block extra_js %}
<script>
function updateSummaryCards() {
    fetch('{% url "analytics:get_data" %}')
        .then(response => response.json())
        .then(data => {
            document.getElementById('totalUsers').textContent = data.total_users;
            document.getElementById('farmerCount').textContent = data.farmer_count;
            document.getElementById('buyerCount').textContent = data.buyer_count;

            document.getElementById('totalRevenue').textContent = (data.total_revenue || 0).toFixed(2);
            document.getElementById('purchaseRevenue').textContent = (data.revenue_breakdown?.purchases || 0).toFixed(2);
            document.getElementById('bidRevenue').textContent = (data.revenue_breakdown?.bids || 0).toFixed(2);
            document.getElementById('cultivationRevenue').textContent = (data.revenue_breakdown?.cultivation || 0).toFixed(2);
            document.getElementById('storageRevenue').textContent = (data.revenue_breakdown?.storage || 0).toFixed(2);

            document.getElementById('totalBookings').textContent = data.total_bookings;
            document.getElementById('storageBookings').textContent = data.storage_bookings;
            document.getElementById('cultivationBookings').textContent = data.cultivation_bookings;

            document.getElementById('totalListings').textContent = data.total_listings;
            document.getElementById('activeListings').textContent = data.active_listings;
        });
}

document.addEventListener('DOMContentLoaded', function() {
    updateSummaryCards();
    document.getElementById('timePeriodFilter').addEventListener('change', updateSummaryCards);
});
</script>
{% endblock %}
