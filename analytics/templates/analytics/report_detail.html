{% extends 'accounts/base.html' %}
{% block content %}
<h3>{{ report.title }}</h3>
<p>Type: {{ report.get_report_type_display }}</p>
<p>Period: {{ report.start_date }} - {{ report.end_date }}</p>
<p>Generated on: {{ report.generated_at }}</p>

<h5>Summary:</h5>
<pre>{{ report.data_summary|json_script:"report-data" }}</pre>
{{ report.chart_data|json_script:"chart-data" }}
<canvas id="reportChart" height="150"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(function(){
  const raw = document.getElementById('chart-data')?.textContent;
  if (!raw) return;

  const chartData = JSON.parse(raw);
  const labels = chartData.labels || [];
  const data = chartData.data || [];

  // If all zeros, pass empty dataset so no bars render but axes visible
  const allZero = data.length === 0 || data.every(v => Number(v) === 0);
  const displayData = allZero ? [] : data;

  new Chart(document.getElementById('reportChart'), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Metrics',
        data: displayData,
        backgroundColor: 'rgba(54,162,235,0.6)',
        borderColor: 'rgba(54,162,235,1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        y: {
          beginAtZero: true,
          suggestedMax: allZero ? 1 : undefined
        }
      }
    }
  });
})();
</script>



{% endblock %}
